<h1>記錄新遊戲</h1>
<%= form_tag('/liff2/games') do %>
  <input type="hidden" name="room_id" value="<%= @room.id %>" />
  <table>
    <tr>
      <th>姓名</th>
      <th>分數</th>
    </tr>
    <% @room.players.each do |player| %>
    <tr>
      <td><%= player.name %></td>
      <td><input type="number" name="records[][score]" onkeyup="sum_check()"/></td>
      <input
        type="hidden"
        name="records[][player_id]"
        value="<%= player.id %>"
      />
    </tr>
    <% end %>
  </table>
  <div>
    <input type="checkbox" name="skip_check" id="skip_check" onclick="sum_check()">
    <label for="skip_check">Skip check</label>
  </div>
  <button type="submit">Send</button>
<% end %>

  <script>
    function sum_check() {
      let sum = 0
      const inputs = document.querySelectorAll('input[type=number]')

      for (let i = 0; i < inputs.length; i++) {
        sum += +inputs[i].value
      }

      if (sum === 0) {
        enable_button(true)
      } else {
        enable_button(false)
      }
    }

    function enable_button(enable=false) {
      const btn = document.querySelector('button')
      const skip_check = document.querySelector('input[type=checkbox]').checked

      if (!!enable || skip_check) {
        btn.disabled = false
        btn.textContent = '儲存'
      } else {
        btn.disabled = true
        btn.textContent = '總和不為零'
      }
    }

    enable_button(false)
  </script>
</form>
